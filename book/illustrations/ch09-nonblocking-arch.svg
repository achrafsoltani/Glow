<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 750 400" width="750" height="400">
  <defs>
    <linearGradient id="eventGoroutine" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#E74C3C;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#C0392B;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="mainGoroutine" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#27AE60;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#1E8449;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="channelGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#3498DB;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#9B59B6;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="socketGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#2C3E50;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#1A252F;stop-opacity:1" />
    </linearGradient>
    <filter id="shadow" x="-5%" y="-5%" width="110%" height="115%">
      <feDropShadow dx="1" dy="2" stdDeviation="2" flood-opacity="0.15"/>
    </filter>
    <marker id="arrow9" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#3498DB"/>
    </marker>
    <marker id="arrow9r" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#E74C3C"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="750" height="400" fill="#FAFAFA"/>

  <!-- Title -->
  <text x="375" y="30" font-family="Arial, sans-serif" font-size="20" font-weight="bold" text-anchor="middle" fill="#333">Non-Blocking Event Architecture</text>

  <!-- X Server / Socket -->
  <g transform="translate(30, 100)" filter="url(#shadow)">
    <rect x="0" y="0" width="140" height="160" rx="8" fill="url(#socketGrad)"/>
    <text x="70" y="30" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">X Server</text>
    <text x="70" y="50" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="rgba(255,255,255,0.7)">Unix Socket</text>

    <rect x="15" y="70" width="110" height="75" rx="4" fill="rgba(255,255,255,0.15)"/>
    <text x="70" y="90" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="rgba(255,255,255,0.9)">KeyPress</text>
    <text x="70" y="105" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="rgba(255,255,255,0.9)">ButtonPress</text>
    <text x="70" y="120" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="rgba(255,255,255,0.9)">Expose</text>
    <text x="70" y="135" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="rgba(255,255,255,0.9)">...</text>
  </g>

  <!-- Event Goroutine -->
  <g transform="translate(220, 70)" filter="url(#shadow)">
    <rect x="0" y="0" width="180" height="190" rx="8" fill="url(#eventGoroutine)"/>
    <text x="90" y="25" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="white">Event Goroutine</text>

    <rect x="10" y="40" width="160" height="140" rx="4" fill="rgba(0,0,0,0.2)"/>
    <text x="90" y="60" font-family="Consolas, monospace" font-size="10" text-anchor="middle" fill="rgba(255,255,255,0.9)">for {</text>
    <text x="90" y="80" font-family="Consolas, monospace" font-size="10" text-anchor="middle" fill="rgba(255,255,255,0.9)">  event := read()</text>
    <text x="90" y="100" font-family="Consolas, monospace" font-size="10" text-anchor="middle" fill="rgba(255,255,255,0.9)">  // blocks here</text>
    <text x="90" y="125" font-family="Consolas, monospace" font-size="10" text-anchor="middle" fill="rgba(255,255,255,0.9)">  channel &lt;- event</text>
    <text x="90" y="145" font-family="Consolas, monospace" font-size="10" text-anchor="middle" fill="rgba(255,255,255,0.9)">  // non-blocking</text>
    <text x="90" y="165" font-family="Consolas, monospace" font-size="10" text-anchor="middle" fill="rgba(255,255,255,0.9)">}</text>
  </g>

  <!-- Arrow from Server to Event Goroutine -->
  <line x1="170" y1="180" x2="215" y2="180" stroke="#E74C3C" stroke-width="2" marker-end="url(#arrow9r)"/>
  <text x="192" y="170" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#E74C3C">read()</text>

  <!-- Event Channel -->
  <g transform="translate(430, 130)" filter="url(#shadow)">
    <rect x="0" y="0" width="80" height="100" rx="8" fill="url(#channelGrad)"/>
    <text x="40" y="25" font-family="Arial, sans-serif" font-size="11" font-weight="bold" text-anchor="middle" fill="white">Channel</text>

    <!-- Events in channel -->
    <rect x="10" y="35" width="60" height="18" rx="3" fill="rgba(255,255,255,0.3)"/>
    <text x="40" y="48" font-family="Consolas, monospace" font-size="8" text-anchor="middle" fill="white">event</text>

    <rect x="10" y="57" width="60" height="18" rx="3" fill="rgba(255,255,255,0.25)"/>
    <text x="40" y="70" font-family="Consolas, monospace" font-size="8" text-anchor="middle" fill="white">event</text>

    <rect x="10" y="79" width="60" height="18" rx="3" fill="rgba(255,255,255,0.2)"/>
    <text x="40" y="92" font-family="Consolas, monospace" font-size="8" text-anchor="middle" fill="white">event</text>
  </g>

  <!-- Arrow from Event Goroutine to Channel -->
  <line x1="400" y1="180" x2="425" y2="180" stroke="#3498DB" stroke-width="2" marker-end="url(#arrow9)"/>

  <!-- Main Goroutine -->
  <g transform="translate(540, 70)" filter="url(#shadow)">
    <rect x="0" y="0" width="180" height="250" rx="8" fill="url(#mainGoroutine)"/>
    <text x="90" y="25" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="white">Main Goroutine</text>

    <rect x="10" y="40" width="160" height="200" rx="4" fill="rgba(0,0,0,0.2)"/>
    <text x="90" y="60" font-family="Consolas, monospace" font-size="10" text-anchor="middle" fill="rgba(255,255,255,0.9)">for running {</text>
    <text x="90" y="85" font-family="Consolas, monospace" font-size="10" text-anchor="middle" fill="#F1C40F">  // Non-blocking!</text>
    <text x="90" y="105" font-family="Consolas, monospace" font-size="10" text-anchor="middle" fill="rgba(255,255,255,0.9)">  pollEvents()</text>
    <text x="90" y="130" font-family="Consolas, monospace" font-size="10" text-anchor="middle" fill="rgba(255,255,255,0.9)">  update()</text>
    <text x="90" y="155" font-family="Consolas, monospace" font-size="10" text-anchor="middle" fill="rgba(255,255,255,0.9)">  render()</text>
    <text x="90" y="180" font-family="Consolas, monospace" font-size="10" text-anchor="middle" fill="rgba(255,255,255,0.9)">  sleep(16ms)</text>
    <text x="90" y="205" font-family="Consolas, monospace" font-size="10" text-anchor="middle" fill="rgba(255,255,255,0.9)">}</text>
    <text x="90" y="230" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="rgba(255,255,255,0.7)">~60 FPS game loop</text>
  </g>

  <!-- Arrow from Channel to Main Goroutine -->
  <line x1="510" y1="180" x2="535" y2="180" stroke="#3498DB" stroke-width="2" marker-end="url(#arrow9)"/>

  <!-- Legend -->
  <g transform="translate(50, 340)">
    <rect x="0" y="0" width="650" height="50" rx="6" fill="#ECF0F1" stroke="#BDC3C7"/>

    <g transform="translate(20, 15)">
      <rect x="0" y="0" width="130" height="25" rx="3" fill="#E74C3C"/>
      <text x="65" y="17" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="white">Blocks on read()</text>
    </g>

    <g transform="translate(170, 15)">
      <rect x="0" y="0" width="130" height="25" rx="3" fill="#3498DB"/>
      <text x="65" y="17" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="white">Buffered channel</text>
    </g>

    <g transform="translate(320, 15)">
      <rect x="0" y="0" width="130" height="25" rx="3" fill="#27AE60"/>
      <text x="65" y="17" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="white">Never blocks!</text>
    </g>

    <g transform="translate(470, 15)">
      <rect x="0" y="0" width="160" height="25" rx="3" fill="#F39C12"/>
      <text x="80" y="17" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="white">PollEvent() returns nil</text>
    </g>
  </g>
</svg>
