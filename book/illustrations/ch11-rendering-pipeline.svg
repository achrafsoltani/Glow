<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 700 350" width="700" height="350">
  <defs>
    <linearGradient id="cmdGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#3498DB;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#2980B9;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="fbGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#27AE60;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#1E8449;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="putGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#E74C3C;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#C0392B;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="dispGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#9B59B6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#8E44AD;stop-opacity:1" />
    </linearGradient>
    <filter id="shadow" x="-5%" y="-5%" width="110%" height="115%">
      <feDropShadow dx="1" dy="2" stdDeviation="2" flood-opacity="0.15"/>
    </filter>
    <marker id="arrow11" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="700" height="350" fill="#FAFAFA"/>

  <!-- Title -->
  <text x="350" y="30" font-family="Arial, sans-serif" font-size="20" font-weight="bold" text-anchor="middle" fill="#333">Software Rendering Pipeline</text>

  <!-- Stage 1: Draw Commands -->
  <g transform="translate(50, 60)" filter="url(#shadow)">
    <rect x="0" y="0" width="150" height="100" rx="8" fill="url(#cmdGrad)"/>
    <text x="75" y="30" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="white">Draw Commands</text>
    <rect x="10" y="40" width="130" height="50" rx="4" fill="rgba(0,0,0,0.2)"/>
    <text x="75" y="58" font-family="Consolas, monospace" font-size="8" text-anchor="middle" fill="rgba(255,255,255,0.9)">DrawRect(x, y, w, h)</text>
    <text x="75" y="72" font-family="Consolas, monospace" font-size="8" text-anchor="middle" fill="rgba(255,255,255,0.9)">DrawLine(x0,y0,x1,y1)</text>
    <text x="75" y="86" font-family="Consolas, monospace" font-size="8" text-anchor="middle" fill="rgba(255,255,255,0.9)">FillCircle(cx, cy, r)</text>
  </g>

  <!-- Arrow 1 -->
  <line x1="200" y1="110" x2="230" y2="110" stroke="#666" stroke-width="2" marker-end="url(#arrow11)"/>

  <!-- Stage 2: Framebuffer -->
  <g transform="translate(240, 60)" filter="url(#shadow)">
    <rect x="0" y="0" width="150" height="100" rx="8" fill="url(#fbGrad)"/>
    <text x="75" y="30" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="white">Framebuffer</text>
    <text x="75" y="48" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="rgba(255,255,255,0.8)">(CPU memory)</text>
    <rect x="15" y="58" width="120" height="35" rx="4" fill="rgba(0,0,0,0.2)"/>
    <text x="75" y="80" font-family="Consolas, monospace" font-size="9" text-anchor="middle" fill="rgba(255,255,255,0.9)">[]byte pixels</text>
  </g>

  <!-- Arrow 2 -->
  <line x1="390" y1="110" x2="420" y2="110" stroke="#666" stroke-width="2" marker-end="url(#arrow11)"/>

  <!-- Stage 3: PutImage -->
  <g transform="translate(430, 60)" filter="url(#shadow)">
    <rect x="0" y="0" width="120" height="100" rx="8" fill="url(#putGrad)"/>
    <text x="60" y="30" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="white">PutImage</text>
    <text x="60" y="48" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="rgba(255,255,255,0.8)">(X11 request)</text>
    <rect x="10" y="58" width="100" height="35" rx="4" fill="rgba(0,0,0,0.2)"/>
    <text x="60" y="80" font-family="Consolas, monospace" font-size="9" text-anchor="middle" fill="rgba(255,255,255,0.9)">→ X Server</text>
  </g>

  <!-- Arrow 3 -->
  <line x1="550" y1="110" x2="580" y2="110" stroke="#666" stroke-width="2" marker-end="url(#arrow11)"/>

  <!-- Stage 4: Display -->
  <g transform="translate(590, 60)" filter="url(#shadow)">
    <rect x="0" y="0" width="80" height="100" rx="8" fill="url(#dispGrad)"/>
    <text x="40" y="30" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="white">Display</text>
    <!-- Monitor icon -->
    <rect x="15" y="45" width="50" height="35" rx="2" fill="#1A252F"/>
    <rect x="18" y="48" width="44" height="25" fill="#3498DB"/>
    <rect x="30" y="80" width="20" height="5" fill="#555"/>
    <rect x="25" y="85" width="30" height="3" rx="1" fill="#444"/>
  </g>

  <!-- Details section -->
  <g transform="translate(50, 190)">
    <rect x="0" y="0" width="600" height="140" rx="8" fill="#ECF0F1" stroke="#BDC3C7"/>
    <text x="300" y="25" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#333">Framebuffer Memory Layout</text>

    <!-- Pixel grid representation -->
    <g transform="translate(30, 40)">
      <text x="0" y="0" font-family="Consolas, monospace" font-size="10" fill="#666">Row 0:</text>
      <rect x="50" y="-12" width="20" height="15" fill="#E74C3C" stroke="#666"/>
      <rect x="72" y="-12" width="20" height="15" fill="#27AE60" stroke="#666"/>
      <rect x="94" y="-12" width="20" height="15" fill="#3498DB" stroke="#666"/>
      <rect x="116" y="-12" width="20" height="15" fill="#F39C12" stroke="#666"/>
      <text x="145" y="0" font-family="Consolas, monospace" font-size="10" fill="#666">... (width pixels × 4 bytes)</text>

      <text x="0" y="25" font-family="Consolas, monospace" font-size="10" fill="#666">Row 1:</text>
      <rect x="50" y="13" width="20" height="15" fill="#9B59B6" stroke="#666"/>
      <rect x="72" y="13" width="20" height="15" fill="#1ABC9C" stroke="#666"/>
      <rect x="94" y="13" width="20" height="15" fill="#E74C3C" stroke="#666"/>
      <rect x="116" y="13" width="20" height="15" fill="#27AE60" stroke="#666"/>
      <text x="145" y="25" font-family="Consolas, monospace" font-size="10" fill="#666">...</text>

      <text x="0" y="50" font-family="Consolas, monospace" font-size="10" fill="#666">...</text>

      <text x="0" y="75" font-family="Consolas, monospace" font-size="10" fill="#666">Row N:</text>
      <rect x="50" y="63" width="20" height="15" fill="#3498DB" stroke="#666"/>
      <rect x="72" y="63" width="20" height="15" fill="#F39C12" stroke="#666"/>
      <rect x="94" y="63" width="20" height="15" fill="#9B59B6" stroke="#666"/>
      <rect x="116" y="63" width="20" height="15" fill="#1ABC9C" stroke="#666"/>
      <text x="145" y="75" font-family="Consolas, monospace" font-size="10" fill="#666">...</text>
    </g>

    <!-- Formula -->
    <g transform="translate(330, 45)">
      <rect x="0" y="0" width="250" height="80" rx="4" fill="#2C3E50"/>
      <text x="125" y="25" font-family="Consolas, monospace" font-size="11" text-anchor="middle" fill="#ECF0F1">Total size = width × height × 4</text>
      <text x="125" y="50" font-family="Consolas, monospace" font-size="11" text-anchor="middle" fill="#ECF0F1">offset = (y×width + x) × 4</text>
      <text x="125" y="70" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="rgba(255,255,255,0.7)">Row-major order, BGRX format</text>
    </g>
  </g>
</svg>
