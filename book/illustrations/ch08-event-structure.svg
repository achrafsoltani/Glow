<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 700 300" width="700" height="300">
  <defs>
    <linearGradient id="typeGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#E74C3C;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#C0392B;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="dataGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#3498DB;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#2980B9;stop-opacity:1" />
    </linearGradient>
    <filter id="shadow" x="-5%" y="-5%" width="110%" height="115%">
      <feDropShadow dx="1" dy="2" stdDeviation="2" flood-opacity="0.15"/>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="700" height="300" fill="#FAFAFA"/>

  <!-- Title -->
  <text x="350" y="30" font-family="Arial, sans-serif" font-size="20" font-weight="bold" text-anchor="middle" fill="#333">X11 Event Structure (32 bytes)</text>

  <!-- Event structure -->
  <g transform="translate(50, 60)" filter="url(#shadow)">
    <!-- Type byte -->
    <rect x="0" y="0" width="50" height="60" rx="4" fill="url(#typeGrad)"/>
    <text x="25" y="25" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="white">Type</text>
    <text x="25" y="40" font-family="Consolas, monospace" font-size="9" text-anchor="middle" fill="rgba(255,255,255,0.8)">1 byte</text>

    <!-- Event-specific data -->
    <rect x="55" y="0" width="545" height="60" rx="4" fill="url(#dataGrad)"/>
    <text x="327" y="25" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">Event-Specific Data</text>
    <text x="327" y="42" font-family="Consolas, monospace" font-size="10" text-anchor="middle" fill="rgba(255,255,255,0.8)">31 bytes (content varies by event type)</text>
  </g>

  <!-- Byte markers -->
  <g transform="translate(50, 130)">
    <line x1="0" y1="0" x2="0" y2="-10" stroke="#666" stroke-width="1"/>
    <text x="0" y="15" font-family="Consolas, monospace" font-size="9" text-anchor="middle" fill="#666">0</text>

    <line x1="50" y1="0" x2="50" y2="-10" stroke="#666" stroke-width="1"/>
    <text x="50" y="15" font-family="Consolas, monospace" font-size="9" text-anchor="middle" fill="#666">1</text>

    <line x1="600" y1="0" x2="600" y2="-10" stroke="#666" stroke-width="1"/>
    <text x="600" y="15" font-family="Consolas, monospace" font-size="9" text-anchor="middle" fill="#666">31</text>

    <text x="325" y="15" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#666">...</text>
  </g>

  <!-- First byte decision -->
  <g transform="translate(50, 160)">
    <rect x="0" y="0" width="600" height="100" rx="6" fill="#ECF0F1" stroke="#BDC3C7"/>
    <text x="300" y="20" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#333">First Byte Determines Message Type</text>

    <g transform="translate(20, 35)">
      <rect x="0" y="0" width="170" height="50" rx="4" fill="#F39C12" filter="url(#shadow)"/>
      <text x="85" y="22" font-family="Consolas, monospace" font-size="11" text-anchor="middle" fill="white">byte[0] == 0</text>
      <text x="85" y="40" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="rgba(255,255,255,0.9)">→ Error Response</text>
    </g>

    <g transform="translate(210, 35)">
      <rect x="0" y="0" width="170" height="50" rx="4" fill="#27AE60" filter="url(#shadow)"/>
      <text x="85" y="22" font-family="Consolas, monospace" font-size="11" text-anchor="middle" fill="white">byte[0] == 1</text>
      <text x="85" y="40" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="rgba(255,255,255,0.9)">→ Reply</text>
    </g>

    <g transform="translate(400, 35)">
      <rect x="0" y="0" width="180" height="50" rx="4" fill="#3498DB" filter="url(#shadow)"/>
      <text x="90" y="22" font-family="Consolas, monospace" font-size="11" text-anchor="middle" fill="white">byte[0] >= 2</text>
      <text x="90" y="40" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="rgba(255,255,255,0.9)">→ Event (type = byte and 0x7F)</text>
    </g>
  </g>

  <!-- Note -->
  <g transform="translate(50, 275)">
    <rect x="0" y="0" width="600" height="25" rx="4" fill="#D5F5E3" stroke="#27AE60"/>
    <text x="300" y="17" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#1E8449">High bit (0x80) indicates synthetic event from SendEvent - mask with 0x7F to get true type</text>
  </g>
</svg>
